<!doctype html>
<html>
	<head>
		<title>Invalid Argument</title>
		<link rel="icon" href="/img/favicon.ico" type="image/x-icon">
		<link rel="stylesheet" type="text/css" media="all" href="/css/reset.css" />
		<link rel="stylesheet" type="text/css" media="all" href="/css/style.css" />
		<!-- <link rel="stylesheet" type="text/css" media="all" href="/css/pygments.css" /> -->
		<link rel="stylesheet" type="text/css" media="all" href="/css/railscasts.css" />
	</head>
	<body>
		<div class="wrapper">
			<header>
				<a href="/"> 
		    	<div id="name">
						<img src="/img/avatar.png" />
		      	<h1>Invalid Argument</h1> 
		      	<h2>Mathew McLoughlin</h2>
		    	</div>
		  	</a>
			</header>
			<div id="content">
				<div class="post">
	<h3><a href="/2013/04/22/custom-deferred-handlers.html">Custom JQuery Deferred Handlers</a></h3>
	<div class="description">
	<p>As the codebase at work gets bigger and bigger I&#8217;ve been trying to think of ways to simplify some of the simple create and update javascript functionality. Our application works by having a context that you can define a resource for then use to perform the CRUD functionality. For example:</p>
<div class='highlight'><pre><code class='js'><span class='kd'>var</span> <span class='nx'>fooContext</span> <span class='o'>=</span> <span class='nx'>context</span><span class='p'>.</span><span class='nx'>define</span><span class='p'>(</span><span class='s1'>&#39;foo&#39;</span><span class='p'>);</span>

<span class='kd'>var</span> <span class='nx'>createButton</span> <span class='o'>=</span> <span class='kd'>function</span><span class='p'>()</span> <span class='p'>{</span>
  <span class='nx'>fooContext</span><span class='p'>.</span><span class='nx'>create</span><span class='p'>(</span><span class='nx'>foo</span><span class='p'>).</span><span class='nx'>then</span><span class='p'>(</span><span class='kd'>function</span><span class='p'>(</span><span class='nx'>response</span><span class='p'>)</span> <span class='p'>{</span>
    <span class='c1'>// Something has been created. Navigate off</span>
  <span class='p'>})</span>
<span class='p'>};</span>

<span class='kd'>var</span> <span class='nx'>updateButton</span> <span class='o'>=</span> <span class='kd'>function</span><span class='p'>()</span> <span class='p'>{</span>
  <span class='nx'>fooContext</span><span class='p'>.</span><span class='nx'>update</span><span class='p'>(</span><span class='nx'>foo</span><span class='p'>).</span><span class='nx'>then</span><span class='p'>(</span><span class='kd'>function</span><span class='p'>(</span><span class='nx'>response</span><span class='p'>)</span> <span class='p'>{</span>
    <span class='c1'>// Something has been updated. Update message</span>
  <span class='p'>})</span>
<span class='p'>};</span>
</code></pre></div>
<p>Now there are a lot of objects in our application so this code appears a lot. So I figured I could combine in it in a similar way to a common pattern on the server side:</p>
<div class='highlight'><pre><code class='js'><span class='k'>if</span> <span class='p'>(</span><span class='nx'>foo</span><span class='p'>.</span><span class='nx'>id</span> <span class='o'>&gt;</span> <span class='mi'>0</span><span class='p'>)</span> <span class='p'>{</span>
  <span class='c1'>// update</span>
<span class='p'>}</span> <span class='k'>else</span> <span class='p'>{</span>
  <span class='c1'>// create</span>
<span class='p'>}</span>
</code></pre></div>
<p>But I also wanted to handle the response differently as well. Now as the astute of you have may noticed I&#8217;m using the JQuery $.Deferred functionality. So I thought I&#8217;d create two custom deferred handlers. One for created and one for updated, and this is how I did it:</p>
<div class='highlight'><pre><code class='js'><span class='kd'>var</span> <span class='nx'>save</span> <span class='o'>=</span> <span class='kd'>function</span><span class='p'>(</span><span class='nx'>item</span><span class='p'>)</span> <span class='p'>{</span>
  <span class='kd'>var</span> <span class='nx'>isUpdate</span> <span class='o'>=</span> <span class='kc'>false</span><span class='p'>;</span>
  <span class='kd'>var</span> <span class='nx'>deferred</span><span class='p'>;</span>

  <span class='k'>if</span> <span class='p'>(</span><span class='nx'>item</span><span class='p'>.</span><span class='nx'>id</span> <span class='o'>&amp;&amp;</span> <span class='nx'>item</span><span class='p'>.</span><span class='nx'>id</span> <span class='o'>&gt;</span> <span class='mi'>0</span><span class='p'>)</span> <span class='p'>{</span>
    <span class='nx'>isUpdate</span> <span class='o'>=</span> <span class='kc'>true</span><span class='p'>;</span>
    <span class='nx'>deferred</span> <span class='o'>=</span> <span class='nx'>update</span><span class='p'>(</span><span class='nx'>item</span><span class='p'>);</span>
  <span class='p'>}</span> <span class='k'>else</span> <span class='p'>{</span>
    <span class='nx'>deferred</span> <span class='o'>=</span> <span class='nx'>create</span><span class='p'>(</span><span class='nx'>item</span><span class='p'>);</span>
  <span class='p'>}</span>

  <span class='c1'>// Additional handlers</span>
  <span class='nx'>deferred</span><span class='p'>.</span><span class='nx'>created</span> <span class='o'>=</span> <span class='kd'>function</span><span class='p'>(</span><span class='nx'>callback</span><span class='p'>)</span> <span class='p'>{</span>
    <span class='k'>if</span> <span class='p'>(</span><span class='o'>!</span><span class='nx'>isUpdate</span><span class='p'>)</span> <span class='p'>{</span>
      <span class='nx'>deferred</span><span class='p'>.</span><span class='nx'>then</span><span class='p'>(</span><span class='nx'>callback</span><span class='p'>);</span>
    <span class='p'>}</span>
    <span class='nx'>deferred</span><span class='p'>;</span>
  <span class='p'>};</span>

  <span class='nx'>deferred</span><span class='p'>.</span><span class='nx'>updated</span> <span class='o'>=</span> <span class='kd'>function</span><span class='p'>(</span><span class='nx'>callback</span><span class='p'>)</span> <span class='p'>{</span>
    <span class='k'>if</span> <span class='p'>(</span><span class='nx'>isUpdate</span><span class='p'>)</span> <span class='p'>{</span>
      <span class='nx'>deferred</span><span class='p'>.</span><span class='nx'>then</span><span class='p'>(</span><span class='nx'>callback</span><span class='p'>);</span>
    <span class='p'>}</span>
    <span class='k'>return</span> <span class='nx'>deferred</span><span class='p'>;</span>
  <span class='p'>};</span> 

  <span class='k'>return</span> <span class='nx'>deferred</span><span class='p'>;</span>
<span class='p'>};</span>
</code></pre></div>
<p>In the example the update and create functions are both deferred as well. This now allows me to write the above code as:</p>
<div class='highlight'><pre><code class='js'><span class='kd'>var</span> <span class='nx'>fooContext</span> <span class='o'>=</span> <span class='nx'>context</span><span class='p'>.</span><span class='nx'>define</span><span class='p'>(</span><span class='s1'>&#39;foo&#39;</span><span class='p'>);</span>

<span class='kd'>var</span> <span class='nx'>saveButton</span> <span class='o'>=</span> <span class='kd'>function</span><span class='p'>()</span> <span class='p'>{</span>
  <span class='nx'>fooContext</span><span class='p'>.</span><span class='nx'>save</span><span class='p'>(</span><span class='nx'>foo</span><span class='p'>).</span><span class='nx'>created</span><span class='p'>(</span><span class='kd'>function</span><span class='p'>(</span><span class='nx'>response</span><span class='p'>)</span> <span class='p'>{</span>
    <span class='c1'>// Something has been created. Navigate off</span>
  <span class='p'>}).</span><span class='nx'>updated</span><span class='p'>(</span><span class='kd'>function</span><span class='p'>(</span><span class='nx'>response</span><span class='p'>)</span> <span class='p'>{</span>
    <span class='c1'>// Something has been updated. Update message</span>
  <span class='p'>});</span>
<span class='p'>};</span>
</code></pre></div>
	</div>
	<div class="post-footer">
		<span class="date">April 22, 2013</span>
		<a href="https://twitter.com/share" class="twitter-share-button" data-url="http://invalid-arg.github.io/2013/04/22/custom-deferred-handlers.html" data-text="Custom JQuery Deferred Handlers" data-via="invalid_arg">Tweet</a>
		<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
	</div>
	<div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'invalidargblog'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
 
</div>
			</div>
		</div>
		<script type="text/javascript">

		  var _gaq = _gaq || [];
		  _gaq.push(['_setAccount', 'UA-1746767-6']);
		  _gaq.push(['_trackPageview']);

		  (function() {
		    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		  })();

		</script>
		<a href="https://twitter.com/invalid_arg" class="twitter-follow-button" data-show-count="false">Follow @invalid_arg</a>
		<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
	</body>
</html>